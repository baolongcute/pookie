<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Plush 4D Heart ‚Äî No Shadow + Text Ring</title>

  <style>
    :root{
      --bg0:#05060d; --bg1:#0b1020; --bg2:#1a0b18;
      --txt:#fff;

      /* updated by JS for 4D tilt + gloss */
      --rx: 10deg;
      --ry: -12deg;
      --lx: 35%;
      --ly: 22%;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      overflow:hidden;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background:
        radial-gradient(1200px 800px at 50% 30%, rgba(112,98,255,.18) 0%, transparent 60%),
        radial-gradient(900px 700px at 70% 60%, rgba(255,45,85,.14) 0%, transparent 62%),
        radial-gradient(900px 700px at 30% 70%, rgba(0,255,209,.07) 0%, transparent 60%),
        linear-gradient(180deg, var(--bg1), var(--bg2) 55%, var(--bg0));
      color:var(--txt);
      user-select:none;
    }

    /* Particle canvas */
    #fx{
      position:fixed;
      inset:0;
      width:100%;
      height:100%;
      display:block;
      z-index:1;
    }

    /* Stage */
    .stage{
      position:fixed;
      inset:0;
      display:grid;
      place-items:center;
      z-index:2;
      pointer-events:none;
    }

    /* n·ªÅn glow tr√≤n (kh√¥ng ph·∫£i shadow). Mu·ªën t·∫Øt th√¨ display:none */
    .aura{
      position:absolute;
      width:min(560px, 84vmin);
      height:min(560px, 84vmin);
      border-radius:50%;
      background: radial-gradient(circle, rgba(255,45,85,.16), rgba(255,45,85,0) 62%);
      filter: blur(12px);
      opacity:.85;
      animation: float 7s ease-in-out infinite;
    }
    @keyframes float{
      0%,100%{ transform: translateY(10px) scale(1); }
      50%{ transform: translateY(-14px) scale(1.03); }
    }

    .heart-wrap{
      position:relative;
      width:min(460px, 78vmin);
      height:min(460px, 78vmin);
      display:grid;
      place-items:center;
      perspective: 1400px;
      transform-style:preserve-3d;
    }

    /* ===== TEXT RING (bao quanh tr√°i tim) ===== */
    .ring-wrap{
      position:absolute;
      inset:-2%;
      display:grid;
      place-items:center;
      pointer-events:none;
      animation: ringBob 6.8s ease-in-out infinite;
    }
    @keyframes ringBob{
      0%,100%{ transform: translateY(2px); }
      50%{ transform: translateY(-4px); }
    }

    .ring{
      width:100%;
      height:100%;
      overflow:visible;
      transform-origin: 50% 50%;
      animation: ringSpin 22s linear infinite;
      opacity: .9;
    }
    /* "t·ª± nhi√™n": thay ƒë·ªïi t·ªëc ƒë·ªô nh·∫π theo ƒëo·∫°n */
    @keyframes ringSpin{
      0%   { transform: rotate(0deg); }
      18%  { transform: rotate(78deg); }
      38%  { transform: rotate(168deg); }
      62%  { transform: rotate(252deg); }
      82%  { transform: rotate(326deg); }
      100% { transform: rotate(360deg); }
    }

    .ring text{
      font-weight: 800;
      font-size: 26px;          /* ch·ªânh to/nh·ªè ·ªü ƒë√¢y */
      letter-spacing: 2px;      /* ch·ªânh ƒë·ªô ‚Äúkh√≠t‚Äù th·ªã gi√°c */
      fill: rgba(255,255,255,.62);
    }

    /* Main heart (NO SHADOW) */
    .heart{
      width:min(360px, 66vmin);
      height:auto;
      transform-style: preserve-3d;
      transform: rotateX(var(--rx)) rotateY(var(--ry));
      filter:none !important;
      overflow: visible; /* tr√°nh clip n·∫øu browser kh√≥ t√≠nh */
    }

    /* Depth stack (NO SHADOW) */
    .heart-stack{
      position:absolute;
      width:min(360px, 66vmin);
      height:auto;
      transform-style:preserve-3d;
      transform: rotateX(var(--rx)) rotateY(var(--ry));
      opacity:.30;
      filter:none !important;
      overflow: visible;
    }
    .layer{
      position:absolute;
      inset:0;
      transform: translateZ(var(--z));
      opacity: var(--o);
      filter: saturate(1.08) contrast(1.03);
    }

    /* Text center */
    .love{
      position:fixed;
      inset:0;
      display:grid;
      place-items:center;
      z-index:5;
      pointer-events:none;
      opacity:0;
      transform: translateY(10px);
      transition: opacity .45s ease, transform .45s ease;
    }
    .love.active{
      opacity:1;
      transform: translateY(0);
    }
    .love-line{
  font-weight: 950;
  font-size: clamp(20px, 3.8vw, 48px);
  letter-spacing: .2px;
  text-align:center;
  padding: 0 18px;
  text-shadow: none;
  position:relative;
  display:inline-flex;
  align-items: baseline;
  gap: 8px;
}

/* ‚úÖ gradient CH·ªà √°p l√™n text th∆∞·ªùng */
.love-line .grad{
  background: linear-gradient(180deg, rgba(255,255,255,.98), rgba(255,255,255,.72));
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;
}

/* ‚úÖ emoji t√°ch ri√™ng, kh√¥ng b·ªã transparent/clip */
.love-line .emoji{
  background: none !important;
  color: #fff;
  -webkit-text-fill-color: initial;
  font-family:
    "Apple Color Emoji",
    "Segoe UI Emoji",
    "Segoe UI Symbol",
    "Noto Color Emoji",
    system-ui, sans-serif;
  font-weight: 700;
}

.love-line::after{
  content:"";
  display:inline-block;
  width: 10px;
  height: 1em;
  border-left: 3px solid rgba(255,255,255,.85);
  margin-left: 10px;
  transform: translateY(6px);
  animation: blink .9s steps(2) infinite;
}
    @keyframes blink { 50% { opacity: 0; } }

    /* Photo overlay */
    .photo-pop{
      position:fixed;
      inset:0;
      display:grid;
      place-items:center;
      z-index:6;
      pointer-events:none;
      opacity:0;
      transform: scale(.92);
      transition: opacity .32s ease, transform .32s ease;
    }
    .photo-pop.active{
      opacity:1;
      transform: scale(1);
    }
    .photo-pop .frame{
      border-radius: 28px;
      padding: 10px;
      background: transparent;
      border: none;
      backdrop-filter: none;
      box-shadow: none; /* ‚úÖ no shadow */
    }
    .photo-pop img{
      display:block;
      width: min(360px, 74vw);
      height: min(360px, 74vw);
      object-fit: cover;
      border-radius: 22px;
      filter: saturate(1.06) contrast(1.06);
    }

    .clicklayer{
      position:fixed;
      inset:0;
      z-index:10;
      cursor:pointer;
    }
  </style>
</head>

<body>
  <canvas id="fx"></canvas>

  <!-- ‚úÖ define symbol s·ªõm ƒë·ªÉ m·ªçi <use href="#H"> d√πng ·ªïn -->
  <svg width="0" height="0" style="position:absolute">
    <defs>
      <!-- Classic heart: ƒë√≠t nh·ªçn, kh√¥ng ‚Äúc·ª•t‚Äù -->
      <symbol id="H" viewBox="0 0 512 512">
        <path d="M256 471s-26-16-54-37c-78-58-154-126-154-217C48 128 112 72 184 72c40 0 70 18 72 20s32-20 72-20c72 0 136 56 136 145 0 91-76 159-154 217-28 21-54 37-54 37z"/>
      </symbol>
    </defs>
  </svg>

  <div class="stage" aria-hidden="true">
    <div class="aura"></div>

    <div class="heart-wrap">

      <!-- ===== V√≤ng ch·ªØ bao quanh tr√°i tim ===== -->
      <div class="ring-wrap" aria-hidden="true">
        <svg class="ring" viewBox="0 0 512 512">
          <defs>
            <!-- r s·∫Ω ƒë·ªìng b·ªô v·ªõi JS (RING_R) -->
            <path id="ringPath"
              d="M256 256 m -228,0 a 228,228 0 1,1 456,0 a 228,228 0 1,1 -456,0" />
          </defs>

          <text>
            <textPath id="ringTextPath" href="#ringPath" startOffset="0%"></textPath>
          </text>
        </svg>
      </div>

      <!-- subtle thickness stack -->
      <div class="heart-stack" aria-hidden="true">
        <svg class="layer" style="--z:-22px; --o:.10" viewBox="0 0 512 512"><use href="#H"></use></svg>
        <svg class="layer" style="--z:-14px; --o:.12" viewBox="0 0 512 512"><use href="#H"></use></svg>
        <svg class="layer" style="--z:-8px;  --o:.14" viewBox="0 0 512 512"><use href="#H"></use></svg>
      </div>

      <svg class="heart" viewBox="0 0 512 512" aria-label="Plush glossy heart (no shadow)">
        <defs>
          <radialGradient id="base" cx="35%" cy="22%" r="78%">
            <stop offset="0" stop-color="#ff9ab0"/>
            <stop offset="0.32" stop-color="#ff3a63"/>
            <stop offset="0.72" stop-color="#ff1f4b"/>
            <stop offset="1" stop-color="#7a001c"/>
          </radialGradient>

          <radialGradient id="gloss" cx="var(--lx)" cy="var(--ly)" r="60%">
            <stop offset="0" stop-color="rgba(255,255,255,0.78)"/>
            <stop offset="0.22" stop-color="rgba(255,255,255,0.30)"/>
            <stop offset="0.55" stop-color="rgba(255,255,255,0.09)"/>
            <stop offset="1" stop-color="rgba(255,255,255,0)"/>
          </radialGradient>
        </defs>

        <g>
          <use href="#H" fill="url(#base)"></use>
          <use href="#H" fill="url(#gloss)" opacity="0.92"></use>

          <path d="M170 160c20-52 78-80 126-58 16 7 32 22 37 39 7 24-3 50-27 62-21 11-49 6-67-13-12-13-22-22-36-33-16-12-35-8-33 3z"
            fill="rgba(255,255,255,0.18)" opacity="0.9"/>
        </g>
      </svg>
    </div>
  </div>

  <div class="love" id="love">
  <div class="love-line" id="typedWrap">
    <span class="grad" id="typedText"></span>
    <span class="emoji" id="typedEmoji"></span>
  </div>
</div>

  <div class="photo-pop" id="photoPop" aria-hidden="true">
    <div class="frame">
      <img id="userPhoto" alt="Your photo" />
    </div>
  </div>

  <div class="clicklayer" id="clicklayer" title="Click"></div>

  <script>
  (() => {
    const TEXT = "Moahüòò";

    // ===== v√≤ng ch·ªØ =====
    const RING_BASE = "I luv youu, Pookieüíï";
    const RING_REPEAT = 8;     // x3/x4 mu·ªën d√†y h∆°n th√¨ tƒÉng s·ªë n√†y
    const RING_R = 228;        // b√°n k√≠nh v√≤ng ch·ªØ (kh√≠t h∆°n -> gi·∫£m nh·∫π)

    const ringTextPath = document.getElementById("ringTextPath");
    ringTextPath.textContent = RING_BASE.repeat(RING_REPEAT);

    // √©p ch·ªØ ‚Äúkh√≠t‚Äù ƒë√∫ng chu vi v√≤ng tr√≤n
    const circumference = 2 * Math.PI * RING_R;
    ringTextPath.setAttribute("textLength", String(Math.round(circumference)));
    ringTextPath.setAttribute("lengthAdjust", "spacingAndGlyphs");

    // ===== ·∫¢nh (Drive thumbnail) =====
    const PHOTOS = [
      "https://drive.google.com/thumbnail?id=1_BgkxtUE8ZZ9LsUrwYgUNF6BFFQmUS0b&sz=w2400"
    ];
    let photoIndex = 0;

    // particles
    let EMIT_RATE = 28;
    let BURST_1 = 70;
    let BURST_2 = 100;
    const MAX_PARTICLES = 650;

    const GRAVITY = 760;
    const DRAG = 0.988;
    const WIND = 10;

    const canvas = document.getElementById("fx");
    const ctx = canvas.getContext("2d", { alpha: true });

    const love = document.getElementById("love");
    const typedText  = document.getElementById("typedText");
    const typedEmoji = document.getElementById("typedEmoji");
    const clicklayer = document.getElementById("clicklayer");

    const photoPop = document.getElementById("photoPop");
    const userPhoto = document.getElementById("userPhoto");

    // preload ·∫£nh
    PHOTOS.forEach(u => { const im = new Image(); im.src = u; });
    userPhoto.src = PHOTOS[0];

    let DPR=1, W=0, H=0;
    let running=false;
    let tPrev=performance.now();
    let emitAcc=0;

    const particles = new Array(MAX_PARTICLES);
    let pCount=0;

    // sound
    let audioCtx = null;
    function loveChime(){
      if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      const t0 = audioCtx.currentTime;

      const master = audioCtx.createGain();
      master.gain.setValueAtTime(0.0001, t0);
      master.gain.exponentialRampToValueAtTime(0.18, t0 + 0.02);
      master.gain.exponentialRampToValueAtTime(0.0001, t0 + 0.95);
      master.connect(audioCtx.destination);

      const freqs = [523.25, 659.25, 783.99];
      freqs.forEach((f, i) => {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        const filt = audioCtx.createBiquadFilter();
        osc.type = "sine";
        osc.frequency.setValueAtTime(f, t0 + i*0.06);

        gain.gain.setValueAtTime(0.0001, t0 + i*0.06);
        gain.gain.exponentialRampToValueAtTime(0.14, t0 + i*0.06 + 0.01);
        gain.gain.exponentialRampToValueAtTime(0.0001, t0 + i*0.06 + 0.40);

        filt.type = "lowpass";
        filt.frequency.setValueAtTime(2400, t0);
        filt.Q.value = 0.75;

        osc.connect(filt); filt.connect(gain); gain.connect(master);
        osc.start(t0 + i*0.06);
        osc.stop(t0 + i*0.06 + 0.45);
      });
    }

    function resize(){
      DPR = Math.min(2, window.devicePixelRatio || 1);
      canvas.width  = Math.floor(window.innerWidth * DPR);
      canvas.height = Math.floor(window.innerHeight * DPR);
      canvas.style.width = window.innerWidth + "px";
      canvas.style.height = window.innerHeight + "px";
      ctx.setTransform(1,0,0,1,0,0);
      ctx.scale(DPR, DPR);
      W = window.innerWidth; H = window.innerHeight;
    }
    window.addEventListener("resize", resize);
    resize();

    // heart sprite (no shadow)
    const sprites=[];
    function makeHeartSprite(size){
      const c=document.createElement("canvas");
      c.width=c.height=size;
      const g=c.getContext("2d");
      g.clearRect(0,0,size,size);

      const cx=size/2, cy=size/2;
      const s=size/36;
      g.save();
      g.translate(cx,cy);
      g.scale(s,s);
      g.translate(-16,-16);

      const grad=g.createLinearGradient(6,0,26,32);
      grad.addColorStop(0,"rgba(255,140,170,0.92)");
      grad.addColorStop(0.55,"rgba(255,45,85,0.92)");
      grad.addColorStop(1,"rgba(165,0,40,0.92)");

      g.beginPath();
      g.moveTo(16,29);
      g.bezierCurveTo(6,22,4,14,9,10);
      g.bezierCurveTo(13,6,18,8,16,13);
      g.bezierCurveTo(14,8,19,6,23,10);
      g.bezierCurveTo(28,14,26,22,16,29);
      g.closePath();
      g.fillStyle=grad; g.fill();

      const h=g.createRadialGradient(14,10,0,14,10,12);
      h.addColorStop(0,"rgba(255,255,255,.45)");
      h.addColorStop(1,"rgba(255,255,255,0)");
      g.fillStyle=h;
      g.beginPath();
      g.ellipse(13, 11, 6, 5, -0.6, 0, Math.PI*2);
      g.fill();

      g.restore();
      return c;
    }
    [18,22,26,30].forEach(sz=>sprites.push(makeHeartSprite(sz)));

    function clamp(v,a,b){ return Math.max(a, Math.min(b, v)); }

    function spawnOne(x,y){
      const p = (pCount<MAX_PARTICLES) ? (particles[pCount]={}) : particles[(Math.random()*MAX_PARTICLES)|0];
      const angle = (-Math.PI/2) + (Math.random()-0.5)*0.78;
      const speed = 210 + Math.random()*270;

      p.x=x; p.y=y;
      p.vx=Math.cos(angle)*speed + (Math.random()-0.5)*60;
      p.vy=Math.sin(angle)*speed - Math.random()*95;

      p.rot=Math.random()*Math.PI*2;
      p.vr=(Math.random()-0.5)*3.4;

      p.size=0.78 + Math.random()*1.05;
      p.life=0;
      p.ttl=1.10 + Math.random()*1.00;
      p.alpha=0.92;
      p.sprite=sprites[(Math.random()*sprites.length)|0];

      if(pCount<MAX_PARTICLES) pCount++;
    }

    function burst(x,y,n){ for(let i=0;i<n;i++) spawnOne(x,y); }

    async function typewriter(text, ms=34){
      typed.textContent="";
      for(let i=0;i<text.length;i++){
        typed.textContent += text[i];
        await new Promise(r=>setTimeout(r,ms));
      }
    }

    const sleep = (ms)=>new Promise(r=>setTimeout(r,ms));

function splitEmojiTail(str){
  const arr = Array.from(str);
  let tail = "";
  // l·∫•y emoji ·ªü CU·ªêI chu·ªói (case "Moahüòò")
  while(arr.length && /[\u{1F300}-\u{1FAFF}\u{2600}-\u{27BF}\u{FE0F}]/u.test(arr[arr.length-1])){
    tail = arr.pop() + tail;
  }
  return [arr.join(""), tail];
}

async function typewriter(text, ms=34){
  typedText.textContent = "";
  typedEmoji.textContent = "";

  const [plain, emo] = splitEmojiTail(text);

  for(const ch of Array.from(plain)){
    typedText.textContent += ch;
    await sleep(ms);
  }
  // emoji hi·ªán chu·∫©n, kh√¥ng b·ªã clip
  typedEmoji.textContent = emo;
}
    // 4D tilt (smooth)
    const root = document.documentElement;
    let targetRx = 10, targetRy = -12, curRx = 10, curRy = -12;
    let targetLx = 35, targetLy = 22, curLx = 35, curLy = 22;
    const lerp = (a,b,t)=>a+(b-a)*t;

    window.addEventListener("pointermove", (ev)=>{
      const nx = (ev.clientX / W) * 2 - 1;
      const ny = (ev.clientY / H) * 2 - 1;

      targetRx = 10 + (-ny) * 18;
      targetRy = -12 + (nx) * 22;

      targetLx = 35 + nx * 18;
      targetLy = 22 + ny * 14;
    }, {passive:true});

    function applyTilt(){
      curRx = lerp(curRx, targetRx, 0.14);
      curRy = lerp(curRy, targetRy, 0.14);
      curLx = lerp(curLx, targetLx, 0.18);
      curLy = lerp(curLy, targetLy, 0.18);

      root.style.setProperty("--rx", curRx.toFixed(2) + "deg");
      root.style.setProperty("--ry", curRy.toFixed(2) + "deg");
      root.style.setProperty("--lx", curLx.toFixed(2) + "%");
      root.style.setProperty("--ly", curLy.toFixed(2) + "%");
    }

    function step(now){
      const dt=Math.min(0.035, (now-tPrev)/1000);
      tPrev=now;

      if(running){
        emitAcc += EMIT_RATE*dt;
        const n=Math.floor(emitAcc); emitAcc -= n;

        const cx=W*0.5, cy=H*0.49;
        for(let i=0;i<n;i++){
          spawnOne(cx+(Math.random()-0.5)*22, cy+(Math.random()-0.5)*16);
        }
      }

      ctx.clearRect(0,0,W,H);

      const vg=ctx.createRadialGradient(W*0.5,H*0.45,80,W*0.5,H*0.5,Math.max(W,H)*0.88);
      vg.addColorStop(0,"rgba(0,0,0,0)");
      vg.addColorStop(1,"rgba(0,0,0,.24)");
      ctx.fillStyle=vg; ctx.fillRect(0,0,W,H);

      for(let i=0;i<pCount;i++){
        const p=particles[i];
        p.life += dt;
        const t=p.life/p.ttl;

        p.vx += (WIND*(0.2+Math.random()*0.35))*dt;
        p.vy += GRAVITY*dt;
        p.vx *= DRAG; p.vy *= DRAG;

        p.x += p.vx*dt;
        p.y += p.vy*dt;
        p.rot += p.vr*dt;

        p.alpha = clamp(1-t,0,1);

        if(p.alpha>0.01 && p.y < H+140){
          ctx.save();
          ctx.globalAlpha=p.alpha;
          ctx.translate(p.x,p.y);
          ctx.rotate(p.rot);
          const s=p.sprite;
          const w=s.width*p.size;
          const h=s.height*p.size;
          ctx.drawImage(s,-w/2,-h/2,w,h);
          ctx.restore();
        } else {
          const last=pCount-1;
          particles[i]=particles[last];
          particles[last]=p;
          pCount--; i--;
        }
      }

      applyTilt();
      requestAnimationFrame(step);
    }
    requestAnimationFrame(step);

    // interaction (triple click trong 900ms)
    let first=false;
    let clickCount = 0;
    let clickTimer = null;

    function showPhoto(){
      if(!PHOTOS.length) return;
      userPhoto.src = PHOTOS[photoIndex];
      photoIndex = (photoIndex + 1) % PHOTOS.length;

      photoPop.classList.add("active");
      setTimeout(() => photoPop.classList.remove("active"), 3500);
    }

    function activate(e){
      loveChime();

      clickCount++;
      clearTimeout(clickTimer);
      clickTimer = setTimeout(() => (clickCount = 0), 900);

      const x=e?.clientX ?? W*0.5;
      const y=e?.clientY ?? H*0.5;

      if(clickCount === 3){
        clickCount = 0;
        showPhoto();
        burst(x, y, 110);
        return;
      }

      if(!first){
        first=true;
        running=true;

        love.classList.add("active");
        typewriter(TEXT, 32);

        burst(x,y,BURST_1);
        burst(W*0.5,H*0.49,BURST_1+25);
      } else {
        burst(x,y,BURST_2);
      }
    }

    function reset(){
      running=false; first=false;
      love.classList.remove("active");
      typed.textContent="";
      pCount=0; emitAcc=0;
      photoPop.classList.remove("active");
      clickCount=0;
    }

    clicklayer.addEventListener("click", activate);

    window.addEventListener("keydown", (ev)=>{
      const k = ev.key.toLowerCase();
      if(k === "r") reset();
      if(k === "escape") photoPop.classList.remove("active");
    });
  })();
  </script>
</body>
</html>
